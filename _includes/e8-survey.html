<body>
  <form id="quizForm">
    <div class="question">
      <label>1. Application Control: Are unauthorised executables blocked?</label>
      <select name="q1">
        <option value="0">No</option>
        <option value="1">Partially</option>
        <option value="2">Yes</option>
      </select>
      <label>Are script interpreters like PowerShell restricted?</label>
      <select name="q2">
        <option value="0">No</option>
        <option value="1">Some restrictions</option>
        <option value="2">Fully restricted</option>
      </select>
      <label>Is application control enforced on all workstations and servers?</label>
      <select name="q3">
        <option value="0">No</option>
        <option value="1">Partially</option>
        <option value="2">Yes</option>
      </select>
    </div>
    <div class="question">
      <label>2. Patch Applications: Are security patches for apps deployed within 48 hours?</label>
      <select name="q4">
        <option value="0">No</option>
        <option value="1">Some patches delayed</option>
        <option value="2">Always within timeframe</option>
      </select>
      <label>Are unsupported applications removed from all systems?</label>
      <select name="q5">
        <option value="0">No</option>
        <option value="1">Some removed</option>
        <option value="2">All removed</option>
      </select>
    </div>
    <div class="question">
      <label>3. Office Macros: Are unsigned macros blocked?</label>
      <select name="q6">
        <option value="0">No</option>
        <option value="1">Some blocked</option>
        <option value="2">All blocked</option>
      </select>
      <label>Are macros only allowed in trusted locations?</label>
      <select name="q7">
        <option value="0">No</option>
        <option value="1">Some controls</option>
        <option value="2">Fully enforced</option>
      </select>
    </div>
    <div class="question">
      <label>4. User App Hardening: Are Flash and Java content blocked in browsers?</label>
      <select name="q8">
        <option value="0">No</option>
        <option value="1">Partially</option>
        <option value="2">Fully implemented</option>
      </select>
      <label>Are ads and popups blocked through browser configuration or extensions?</label>
      <select name="q9">
        <option value="0">No</option>
        <option value="1">Some implemented</option>
        <option value="2">Yes, across environment</option>
      </select>
    </div>
    <div class="question">
      <label>5. Admin Privileges: Are admin accounts separated from normal accounts?</label>
      <select name="q10">
        <option value="0">No</option>
        <option value="1">Some separation</option>
        <option value="2">Full separation enforced</option>
      </select>
      <label>Is use of admin privileges monitored and logged?</label>
      <select name="q11">
        <option value="0">No</option>
        <option value="1">Some monitoring</option>
        <option value="2">Fully monitored</option>
      </select>
    </div>
    <div class="question">
      <label>6. Patch OS: Are critical OS patches applied within 48 hours?</label>
      <select name="q12">
        <option value="0">No</option>
        <option value="1">Sometimes</option>
        <option value="2">Always</option>
      </select>
      <label>Is automated patching in place for operating systems?</label>
      <select name="q13">
        <option value="0">No</option>
        <option value="1">Partially</option>
        <option value="2">Yes</option>
      </select>
    </div>
    <div class="question">
      <label>7. Multi-Factor Authentication: Is MFA enforced for remote access?</label>
      <select name="q14">
        <option value="0">No</option>
        <option value="1">Some users</option>
        <option value="2">All users</option>
      </select>
      <label>Is MFA enforced for all privileged accounts?</label>
      <select name="q15">
        <option value="0">No</option>
        <option value="1">Some</option>
        <option value="2">All</option>
      </select>
    </div>
    <div class="question">
      <label>8. Backups: Are backups performed daily?</label>
      <select name="q16">
        <option value="0">No</option>
        <option value="1">Weekly</option>
        <option value="2">Daily</option>
      </select>
      <label>Are backups tested for integrity and restoration?</label>
      <select name="q17">
        <option value="0">No</option>
        <option value="1">Occasionally</option>
        <option value="2">Regularly tested</option>
      </select>
    </div>
    <button type="button" onclick="calculateScore()">Submit</button>
  </form>

  <div id="result" class="result" style="display:none;"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function calculateScore() {
      const form = document.getElementById('quizForm');
      const formData = new FormData(form);
      let score = 0;
      let answers = [];

      for (let [key, value] of formData.entries()) {
        score += parseInt(value);
        answers.push(value);
      }

      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `<h2>Your Cyber Readiness Score: ${score}/34</h2>`;

      if (score >= 28) {
        resultDiv.innerHTML += '<p>Your organisation appears to have strong cyber controls in place. Great job!</p>';
      } else if (score >= 20) {
        resultDiv.innerHTML += '<p>You're on the right track, but there are several areas needing improvement.</p>';
      } else {
        resultDiv.innerHTML += '<p>Your cyber maturity is low. We recommend a full Essential 8 assessment with PECyber.</p>';
      }

      const button = document.createElement('button');
      button.textContent = 'Download PDF Report';
      button.onclick = () => generatePDF(score);
      resultDiv.appendChild(button);
    }

    function generatePDF(score) {
      const {{ jsPDF }} = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("PECyber - Essential 8 Self Assessment", 20, 20);
      doc.setFontSize(12);
      doc.text(`Score: ${score}/34`, 20, 30);
      doc.text("Assessment Summary:", 20, 40);
      if (score >= 28) {
        doc.text("You appear to have strong cyber controls in place.", 20, 50);
      } else if (score >= 20) {
        doc.text("There are several areas for improvement in your E8 posture.", 20, 50);
      } else {
        doc.text("Your cyber maturity is low. We recommend a formal assessment.", 20, 50);
      }
      doc.save("PECyber_E8_Assessment.pdf");
    }
  </script>
</body>
