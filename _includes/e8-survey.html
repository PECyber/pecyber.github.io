<body>
<form id="quizForm" method="POST" action="https://formspree.io/f/xvgaoang" novalidate>
  <style>
    .question { margin-bottom: 2rem; }
    select, select option {
      color: #000;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 0.4em;
      font-size: 1em;
    }
    select:disabled, select option:disabled { color: #aaa; }
    .result { margin-top: 1rem; }
  </style>
  
  <div class="question">
    <b><label>Application Control</label></b>
    <label>Is a baseline of approved applications maintained and enforced?</label>
    <select name="Baseline">
      <option value="0">No</option><option value="1">Partially</option><option value="2">Yes</option>
    </select>
    <label>Is application control updated in response to threat intelligence?</label>
    <select name="Updated in Response to Threat Ingelligence?">
      <option value="0">No</option><option value="1">Occasionally</option><option value="2">Yes, proactively</option>
    </select>
    <label>Are unauthorised executables blocked?</label>
    <select name="Are unauthorised executables blocked?">
      <option value="0">No</option><option value="1">Partially</option><option value="2">Yes</option>
    </select>
    <label>Is application control enforced on all workstations and servers?</label>
    <select name="Enforced">
      <option value="0">No</option><option value="1">Some</option><option value="2">All</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>Patch Applications</label></b>
    <label>Are vulnerability scans run regularly to identify unpatched applications?</label>
    <select name="Vuln Scans">
      <option value="0">No</option><option value="1">Occasionally</option><option value="2">Yes, regularly</option>
    </select>
    <label>Are security patches for apps deployed within 48 hours?</label>
    <select name="48hr Deployment">
      <option value="0">No</option><option value="1">Some patches delayed</option><option value="2">Always within timeframe</option>
    </select>
    <label>Are unsupported applications removed from all systems?</label>
    <select name="Unsupported Applications">
      <option value="0">No</option><option value="1">Some removed</option><option value="2">All removed</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>Microsoft Office Macros</label></b>
    <label>Are unsigned macros blocked?</label>
    <select name="Unsigned Macros">
      <option value="0">No</option><option value="1">Some blocked</option><option value="2">All blocked</option>
    </select>
    <label>Are macros only allowed in trusted locations?</label>
    <select name="Trusted Locations">
      <option value="0">No</option><option value="1">Some controls</option><option value="2">Fully enforced</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>User Application Hardening</label></b>
    <label>Are Flash and Java content blocked in browsers?</label>
    <select name="Applets">
      <option value="0">No</option><option value="1">Partially</option><option value="2">Fully implemented</option>
    </select>
    <label>Are ads and popups blocked through browser configuration or extensions?</label>
    <select name="Ads">
      <option value="0">No</option><option value="1">Some implemented</option><option value="2">Yes, across environment</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>Restrict Admin Privileges</label></b>
    <label>Are just-in-time admin access controls in use?</label>
    <select name="JustInTimeAdmin">
      <option value="0">No</option><option value="1">Partially</option><option value="2">Yes</option>
    </select>
    <label>Is admin activity regularly reviewed and audited?</label>
    <select name="AdmiN Reviews">
      <option value="0">No</option><option value="1">Occasionally</option><option value="2">Regularly</option>
    </select>
    <label>Are admin accounts separated from normal accounts?</label>
    <select name="Account Separation">
      <option value="0">No</option><option value="1">Some separation</option><option value="2">Full separation enforced</option>
    </select>
    <label>Is use of admin privileges monitored and logged?</label>
    <select name="Monitoring">
      <option value="0">No</option><option value="1">Some monitoring</option><option value="2">Fully monitored</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>Patch Operating Systems</label></b>
    <label>Are critical OS patches applied within 48 hours?</label>
    <select name="OS 48hr Patches">
      <option value="0">No</option><option value="1">Sometimes</option><option value="2">Always</option>
    </select>
    <label>Is automated patching in place for operating systems?</label>
    <select name="Automation">
      <option value="0">No</option><option value="1">Partially</option><option value="2">Yes</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>Multi-Factor Authentication</label></b>
    <label>Is MFA enforced for remote access?</label>
    <select name="MFA Enforced Remote Access">
      <option value="0">No</option><option value="1">Some users</option><option value="2">All users</option>
    </select>
    <label>Is MFA enforced for all privileged accounts?</label>
    <select name="MFA Enforced Admin">
      <option value="0">No</option><option value="1">Some</option><option value="2">All</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <b><label>Regular Backups</label></b>
    <label>Are backups performed daily?</label>
    <select name="Daily">
      <option value="0">No</option><option value="1">Weekly</option><option value="2">Daily</option>
    </select>
    <label>Are backups tested for integrity and restoration?</label>
    <select name="Tested">
      <option value="0">No</option><option value="1">Occasionally</option><option value="2">Regularly tested</option>
    </select>
    <label>Are backups protected from unauthorised modification and deletion?</label>
    <select name="Backups Protected">
      <option value="0">No</option><option value="1">Some controls in place</option><option value="2">Fully protected</option>
    </select>
    <label>Are backups replicated offsite or stored offline?</label>
    <select name="Offsite">
      <option value="0">No</option><option value="1">Some data</option><option value="2">All critical data</option>
    </select>
  </div>
  <br><br>
  <div class="question">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required style="width:100%; padding:8px;">

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required style="width:100%; padding:8px;">
  </div>

  <input type="hidden" name="score" id="scoreField">
  <input type="hidden" name="summary" id="summaryField">

  <button type="submit">Submit</button>
</form>

<div id="result" class="result" style="display:none;"></div>
<div id="confirmationMessage" class="result" style="display:none; background:#dff0d8; color:#3c763d; margin-top:20px; padding:10px; border:1px solid #d6e9c6;">
  <strong>Thank you!</strong> Your submission has been received.
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // Attach one submit handler
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('quizForm');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      // Native validation (required + email format)
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Calculate score
      const { score, max, summary } = calculateScore(form);

      // Show result
      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `<h2>Your Cyber Readiness Score: ${score}/${max}</h2><p>${summary}</p>`;

      const pdfBtn = document.createElement('button');
      pdfBtn.type = 'button';
      pdfBtn.textContent = 'Download PDF Report';
      pdfBtn.onclick = () => generatePDF(score, max);
      resultDiv.appendChild(pdfBtn);

      // Populate hidden fields BEFORE creating FormData
      document.getElementById('scoreField').value = `${score}/${max}`;
      document.getElementById('summaryField').value = summary;

      // Submit to Formspree
try {
  const resp = await fetch(form.action, {
    method: 'POST',
    body: new FormData(form),
    headers: { 'Accept': 'application/json' }
  });

  const data = await resp.json().catch(() => ({}));

  if (resp.ok) {
    document.getElementById('confirmationMessage').style.display = 'block';
    form.reset();
  } else {
    const msg = (data && data.errors)
      ? data.errors.map(e => e.message).join('\n')
      : `Formspree error: HTTP ${resp.status}`;
    alert(msg);
  }
} catch (e) {
  alert('Network error submitting the form.');
}


  function calculateScore(form) {
    let score = 0;
    const selects = form.querySelectorAll('select');
    selects.forEach(sel => {
      const v = Number(sel.value);
      if (!Number.isNaN(v)) score += v;
    });

    const max = 46;
    let summary = '';
    if (score >= 38) {
      summary = "Excellent! Your organisation shows a strong cyber maturity. Contact PECyber for tailored continuous improvement strategies.";
    } else if (score >= 28) {
      summary = "You're on the right track. PECyber can assist with a detailed Essential 8 assessment.";
    } else {
      summary = "Your cyber maturity may be low. PECyber recommends a comprehensive review and uplift journey.";
    }
    return { score, max, summary };
  }

  function generatePDF(score, max) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("PECyber - Essential 8 Self Assessment", 20, 20);
    doc.setFontSize(12);
    doc.text(`Score: ${score}/${max}`, 20, 30);
    doc.text("Assessment Summary:", 20, 40);
    const line = (score >= 38)
      ? "Strong cyber maturity. Contact PECyber for ongoing improvement."
      : (score >= 28)
        ? "Moderate maturity. PECyber can help with deeper assessments."
        : "Low maturity. PECyber recommends a full Essential 8 uplift.";
    doc.text(line, 20, 50);
    doc.save("PECyber_E8_Assessment.pdf");
  }
</script>
</body>
